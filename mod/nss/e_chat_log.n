extern("inc_chatlog")
extern("inc_cdb")

void main() {
	struct EventInfo ei = GetEventInfo();
	struct EventArguments ea = GetEventArguments(ei.serial);

	if (ei.ev != "chat_prefilter")
		return;

	if (ea.i0 & CHATMODE_DM_MODE)
		ea.i0 -= CHATMODE_DM_MODE;

	string aid = itoa(GetAccountID(ei.actor));
	string cid = itoa(GetCharacterID(ei.actor));
	SetLocalString(GetModule(),  "last_chat_message_text_" + aid + "_" + cid, ea.a0);
	SetLocalInt(GetModule(), "last_chat_message_mode_" + aid + "_" + cid, ea.i0);
	SetLocalObject(GetModule(), "last_chat_message_on_" + aid + "_" + cid, ei.actedon);

	ChatLog(ei.actor, ea.i0, ea.a0, ei.actedon);
}
